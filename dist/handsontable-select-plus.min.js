!function(e,t){var i=e.editors.TextEditor.prototype.extend();i.prototype.init=function(){e.editors.TextEditor.prototype.init.apply(this,arguments),this.reset()},i.prototype.reset=function(){this.timer=null,this.items=[],this.filteredItems=[],this.selectedIndex=-1,this.highlightedIndex=-1},i.prototype.createElements=function(){e.editors.TextEditor.prototype.createElements.apply(this,arguments),this.selectPlusWrapper=document.createElement("DIV"),e.Dom.addClass(this.selectPlusWrapper,"select-plus-wrapper"),this.selectPlusWrapper.style.display="none",this.selectPlusList=document.createElement("UL"),e.Dom.addClass(this.selectPlusList,"select-plus-list"),this.selectPlusWrapper.appendChild(this.selectPlusList),this.instance.rootElement.appendChild(this.selectPlusWrapper)},i.prototype.prepare=function(t,i,s,l,r,o){e.editors.TextEditor.prototype.prepare.apply(this,arguments);var n=this.cellProperties.items||[];"function"==typeof n&&(n=n(t,i,s,l,r,o,this.instance)),this.items=n,this.filteredItems=n,this.renderList()},i.prototype.open=function(){e.editors.TextEditor.prototype.open.apply(this,arguments),this.show(),this.handleHighlightIndexChange(),this.instance.addHook("beforeKeyDown",this.onBeforeKeyDown)},i.prototype.close=function(){e.editors.TextEditor.prototype.close.apply(this,arguments),this.hide(),this.instance.removeHook("beforeKeyDown",this.onBeforeKeyDown),this.reset()},i.prototype.getValue=function(){var e=this.getSelectedItem();return e?e.value:""},i.prototype.setValue=function(e){for(var t=-1,i=0;i<this.filteredItems.length;i++){var s=this.filteredItems[i];if(String(s.value)===String(e)){t=i;break}}if(-1===t)this.TEXTAREA.value="";else{this.selectedIndex=t,this.highlightedIndex=t;var l=this.getSelectedItem();this.TEXTAREA.value=l?l.label:"",this.renderList()}},i.prototype.onBeforeKeyDown=function(t){var i=this.getActiveEditor();if((t.keyCode!==e.helper.KEY_CODES.C||!t.ctrlKey&&!t.metaKey)&&t.keyCode!==e.helper.KEY_CODES.ARROW_LEFT&&t.keyCode!==e.helper.KEY_CODES.ARROW_RIGHT){if(t.keyCode===e.helper.KEY_CODES.ARROW_UP||t.keyCode===e.helper.KEY_CODES.ARROW_DOWN)return t.keyCode===e.helper.KEY_CODES.ARROW_UP?i.highlightedIndex=i.highlightedIndex<=0?i.filteredItems.length-1:i.highlightedIndex-1:i.highlightedIndex=i.highlightedIndex>=i.filteredItems.length-1?0:i.highlightedIndex+1,i.handleHighlightIndexChange(),t.preventDefault(),void t.stopImmediatePropagation();if(t.keyCode===e.helper.KEY_CODES.ENTER)return-1!==i.highlightedIndex&&(i.selectedIndex=i.highlightedIndex,i.handleSelectItem(i.getSelectedItem())),t.preventDefault(),void t.stopImmediatePropagation();this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){i.filterItems(i.TEXTAREA.value),i.renderList()},200)}},i.prototype.filterItems=function(e){var t=this.items;this.filteredItems=t.filter(function(t){var i=t.label||"";return 0===i.toLowerCase().indexOf(e.toLowerCase())}),this.highlightedIndex=0===this.filteredItems.length||0===e.length?-1:0},i.prototype.renderList=function(t){t=t||this.filteredItems;var i=this.highlightedIndex;e.Dom.empty(this.selectPlusList);for(var s=0;s<t.length;s++){var l=t[s],r=document.createElement("LI");e.Dom.addClass(r,"select-plus-item"),i===s&&e.Dom.addClass(r,"select-plus-item-highlight"),r.textContent=l.label,r.addEventListener("click",this.handleItemClick(l,s)),this.selectPlusList.appendChild(r)}},i.prototype.handleHighlightIndexChange=function(){for(var t=this.selectPlusList.querySelectorAll(".select-plus-item"),i=null,s=0;s<t.length;s++){var l=t[s];this.highlightedIndex===s?(e.Dom.addClass(l,"select-plus-item-highlight"),i=t[s]):e.Dom.hasClass(l,"select-plus-item-highlight")&&e.Dom.removeClass(l,"select-plus-item-highlight")}if(i){var r=e.Dom.innerHeight(this.selectPlusWrapper),o=e.Dom.offset(this.selectPlusWrapper),n=this.selectPlusWrapper.scrollTop,h=e.Dom.innerHeight(i),p=e.Dom.offset(i),d=p.top-n,a=0;d<=o.top?a=d-o.top:d+h>=o.top+r&&(a=d+h-(o.top+r)),this.selectPlusWrapper.scrollTop+=a}},i.prototype.handleItemClick=function(e){var t=this;return function(i){t.handleSelectItem(e)}},i.prototype.handleSelectItem=function(e){this.setValue(e.value),this.refreshDimensions(),this.finishEditing()},i.prototype.getSelectedItem=function(){var e=this.filteredItems[this.selectedIndex];return e?e:void 0},i.prototype.show=function(){var t=e.Dom.outerHeight(this.TD),i=e.Dom.outerWidth(this.TD),s=e.Dom.offset(this.instance.rootElement),l=e.Dom.offset(this.TD);this.selectPlusWrapper.style.position="absolute",this.selectPlusWrapper.style.top=l.top-s.top+t+"px",this.selectPlusWrapper.style.left=l.left-s.left+"px",this.selectPlusWrapper.style.minWidth=i+"px",this.selectPlusWrapper.style.display=""},i.prototype.hide=function(){this.selectPlusWrapper.scrollTop=0,this.selectPlusWrapper.style.display="none"};var s=document.createElement("DIV");s.className="htAutocompleteArrow",s.appendChild(document.createTextNode(String.fromCharCode(9660)));var l=function(i,l,r,o,n,h,p){h=h||"";var d=p.items||[];"function"==typeof d&&(d=d(r,o,n,l,h,p,i));for(var a=null,c=0;c<d.length;c++)if(d[c].value===h){a=d[c];break}e.Dom.empty(l);var u=s.cloneNode(!0);return u.addEventListener("click",function(){i.view.wt.getSetting("onCellDblClick",null,new t(r,o),l)}),l.appendChild(document.createTextNode(a?a.label:h)),l.appendChild(u),e.Dom.addClass(l,"htAutocomplete"),l};e.editors.SelectPlusEditor=i,e.editors.registerEditor("selectPlus",i),e.renderers.SelectPlusRenderer=l,e.renderers.registerRenderer("selectPlus",l),e.cellTypes.selectPlus={editor:e.editors.SelectPlusEditor,renderer:e.renderers.SelectPlusRenderer}}(Handsontable,WalkontableCellCoords);